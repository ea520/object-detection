include(ExternalProject)

set(OPENCV_DIR ${CMAKE_BINARY_DIR}/install)

# Download and compile opencv using cmake
ExternalProject_Add(opencv46
  GIT_REPOSITORY https://github.com/opencv/opencv.git
  GIT_TAG 4.6.0
  SOURCE_DIR opencv
  BINARY_DIR opencv-build
  UPDATE_COMMAND ""
  PATCH_COMMAND ""
  CMAKE_ARGS
    -D BUILD_INFO_SKIP_EXTRA_MODULES:BOOL=OFF
    -D BUILD_EXAMPLES:BOOL=OFF
    -D BUILD_JASPER:BOOL=OFF
    -D BUILD_JAVA:BOOL=OFF
    -D BUILD_JPEG:BOOL=ON
    -D BUILD_opencv_apps:BOOL=ON
    -D BUILD_opencv_java:BOOL=OFF
    -D BUILD_opencv_python2:BOOL=OFF
    -D BUILD_opencv_python3:BOOL=OFF
    -D BUILD_OPENEXR:BOOL=OFF
    -D BUILD_PNG:BOOL=ON 
    -D BUILD_TBB:BOOL=OFF
    -D BUILD_WEBP:BOOL=OFF
    -D BUILD_ZLIB:BOOL=ON 
    -D WITH_1394:BOOL=OFF
    -D WITH_CUDA:BOOL=OFF
    -D WITH_EIGEN:BOOL=OFF
    -D WITH_GPHOTO2:BOOL=OFF
    -D WITH_GSTREAMER:BOOL=ON
    -D OPENCV_GAPI_GSTREAMER:BOOL=OFF 
    -D WITH_GTK_2_X:BOOL=OFF
    -D WITH_IPP:BOOL=ON
    -D WITH_JASPER:BOOL=OFF
    -D WITH_LAPACK:BOOL=OFF
    -D WITH_MATLAB:BOOL=OFF 
    -D WITH_MFX:BOOL=ON
    -D WITH_OPENCLAMDBLAS:BOOL=OFF
    -D WITH_OPENCLAMDFFT:BOOL=OFF
    -D WITH_OPENEXR:BOOL=OFF 
    -D WITH_OPENJPEG:BOOL=OFF 
    -D WITH_QUIRC:BOOL=OFF
    -D WITH_TBB:BOOL=OFF
    -D WITH_TIFF:BOOL=OFF
    -D WITH_VTK:BOOL=OFF
    -D WITH_WEBP:BOOL=OFF
    -D CMAKE_USE_RELATIVE_PATHS:BOOL=ON
    -D CMAKE_SKIP_INSTALL_RPATH:BOOL=ON 
    -D ENABLE_BUILD_HARDENING:BOOL=ON
    -D ENABLE_CONFIG_VERIFICATION:BOOL=ON 
    -D ENABLE_PRECOMPILED_HEADERS:BOOL=OFF 
    -D ENABLE_CXX11:BOOL=ON 
    -D INSTALL_PDB:BOOL=ON
    -D INSTALL_TESTS:BOOL=OFF 
    -D INSTALL_C_EXAMPLES:BOOL=OFF
    -D INSTALL_PYTHON_EXAMPLES:BOOL=OFF
    -D OPENCV_SKIP_PKGCONFIG_GENERATION:BOOL=ON 
    -D OPENCV_SKIP_PYTHON_LOADER:BOOL=ON
    -D OPENCV_SKIP_CMAKE_ROOT_CONFIG:BOOL=ON
    -D OPENCV_GENERATE_SETUPVARS:BOOL=OFF 
    -D BUILD_opencv_world:BOOL=OFF 
    -D BUILD_opencv_python2:BOOL=OFF
    -D BUILD_opencv_python3:BOOL=OFF
    -D WITH_OPENVINO:BOOL=ON
    -D BUILD_SHARED_LIBS:BOOL=ON
    -D OPENCV_IPP_GAUSSIAN_BLUR:BOOL=ON
    -D OPENCV_INSTALL_FFMPEG_DOWNLOAD_SCRIPT:BOOL=ON 
    -D OPENCV_BIN_INSTALL_PATH:STRING=bin
    -D OPENCV_INCLUDE_INSTALL_PATH:STRING=include
    -D OPENCV_LIB_INSTALL_PATH:STRING=lib
    -D OPENCV_CONFIG_INSTALL_PATH:STRING=cmake
    -D OPENCV_3P_LIB_INSTALL_PATH:STRING=3rdparty
    -D OPENCV_SAMPLES_SRC_INSTALL_PATH:STRING=samples
    -D OPENCV_DOC_INSTALL_PATH:STRING="doc"
    -D OPENCV_OTHER_INSTALL_PATH:STRING=etc
    -D OPENCV_LICENSES_INSTALL_PATH:STRING=etc/licenses
    -D HIGHGUI_PLUGIN_LIST:STRING=all
    -D CPU_BASELINE:STRING=SSE4_2
    -DCMAKE_BUILD_TYPE:STRING=Release
    -D CMAKE_INSTALL_PREFIX:PATH=${OPENCV_DIR}
    -D CMAKE_EXE_LINKER_FLAGS=-Wl,--allow-shlib-undefined
    -D VIDEOIO_PLUGIN_LIST=ffmpeg,gstreamer,mfx
)

set(OpenCV_LIB_COMPONENTS opencv_calib3d;opencv_core;opencv_dnn;opencv_features2d;opencv_flann;opencv_gapi;opencv_highgui;opencv_imgcodecs;opencv_imgproc;opencv_ml;opencv_objdetect;opencv_photo;opencv_stitching;opencv_video;opencv_videoio)
